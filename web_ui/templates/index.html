<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thumbnail Generator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>Thumbnail Generator</h1>
            <p class="subtitle">Create stunning game thumbnails with ease</p>
        </header>

        <!-- Mode Selector -->
        <div class="mode-selector">
            <button class="mode-btn active" data-mode="bulk">Bulk Process</button>
            <button class="mode-btn" data-mode="single">Single Game</button>
        </div>

        <!-- Main Content -->
        <div class="content">
            <!-- Bulk Mode -->
            <div id="bulk-mode" class="mode-content active">
                <div class="section">
                    <h2>Select Games</h2>
                    <div class="filter-controls">
                        <label for="provider-filter">Filter by Provider:</label>
                        <select id="provider-filter" class="select-input">
                            <option value="">All Providers</option>
                        </select>
                    </div>
                    <div class="bulk-controls">
                        <button id="select-all-btn" class="btn btn-secondary">Select All</button>
                        <button id="deselect-all-btn" class="btn btn-secondary">Deselect All</button>
                    </div>

                    <div id="bulk-games-list" class="games-list"></div>
                </div>

                <div class="section">
                    <h2>Settings</h2>
                    <div class="control-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="bulk-blur-enabled" checked>
                            <span>Enable blur band</span>
                        </label>

                        <div id="bulk-blur-options" class="blur-options">
                            <div class="radio-group">
                                <label class="radio-label">
                                    <input type="radio" name="bulk-blur-mode" value="auto" checked>
                                    <span>Auto-detect from background</span>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="bulk-blur-mode" value="manual">
                                    <span>Manual color selection</span>
                                </label>
                            </div>

                            <div id="bulk-color-picker-group" class="color-picker-group" style="display: none;">
                                <label for="bulk-blur-color">Blur Color:</label>
                                <input type="color" id="bulk-blur-color" value="#000000">
                            </div>
                        </div>
                    </div>

                    <div class="radio-group">
                        <h3>Title</h3>
                        <label class="radio-label">
                            <input type="radio" name="bulk-title-mode" value="text" checked>
                            <span>Auto from folder name</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="bulk-title-mode" value="image">
                            <span>Use title image</span>
                        </label>
                    </div>

                    <div class="radio-group">
                        <h3>Provider</h3>
                        <label class="radio-label">
                            <input type="radio" name="bulk-provider-mode" value="none">
                            <span>Don't show</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="bulk-provider-mode" value="text" checked>
                            <span>Auto from provider name</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="bulk-provider-mode" value="logo">
                            <span>Use provider logo</span>
                        </label>
                    </div>

                    <div class="control-group">
                        <h3>Title Font</h3>
                        <label class="checkbox-label">
                            <input type="checkbox" id="bulk-custom-font-enabled">
                            <span>Use custom font</span>
                        </label>
                        <div id="bulk-font-select-container" class="font-select-container" style="display: none;">
                            <select id="bulk-font-select" class="select-input">
                                <option value="">Loading fonts...</option>
                            </select>
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>Font Settings</h3>
                        <p class="help-text">Manage default fonts for titles and providers</p>
                        <button id="open-provider-font-modal" class="btn btn-secondary">
                            Font Settings...
                        </button>
                    </div>

                    <!-- Custom Dimensions (BETA) -->
                    <div class="control-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="bulk-custom-dimensions">
                            <span>Custom Output Size (BETA)</span>
                        </label>
                        <div id="bulk-dimensions-controls" style="display: none; margin-left: 20px; margin-top: 10px;">
                            <div style="display: flex; gap: 10px; margin-bottom: 8px;">
                                <div>
                                    <label style="font-size: 12px; color: var(--text-secondary);">Width (px)</label><br>
                                    <input type="number" id="bulk-canvas-width" value="440" min="100" max="4000" class="input-field" style="width: 80px;">
                                </div>
                                <div>
                                    <label style="font-size: 12px; color: var(--text-secondary);">Height (px)</label><br>
                                    <input type="number" id="bulk-canvas-height" value="590" min="100" max="4000" class="input-field" style="width: 80px;">
                                </div>
                            </div>
                            <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 8px;">
                                Aspect Ratio: <span id="bulk-aspect-ratio">0.75:1 (Portrait)</span>
                            </div>
                            <div style="display: flex; gap: 5px;">
                                <button type="button" class="preset-btn" onclick="setBulkDimensions(590, 590)">Square</button>
                                <button type="button" class="preset-btn" onclick="setBulkDimensions(787, 443)">16:9</button>
                                <button type="button" class="preset-btn" onclick="setBulkDimensions(440, 590)">Reset</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="actions">
                    <button id="generate-bulk-btn" class="btn btn-primary" disabled>
                        Generate Selected
                    </button>
                    <button id="manage-content-bulk-btn" class="btn btn-secondary">
                        Manage Content...
                    </button>
                    <button id="open-output-bulk-btn" class="btn btn-secondary">
                        Open Output Folder
                    </button>
                </div>

                <div id="bulk-progress" class="progress-bar" style="display: none;">
                    <div id="progress-fill" class="progress-fill"></div>
                    <span id="progress-text" class="progress-text">0%</span>
                </div>

                <div id="bulk-status" class="status"></div>
            </div>

            <!-- Single Game Mode -->
            <div id="single-mode" class="mode-content">
                <div class="section">
                    <h2>Select Game</h2>
                    <div class="search-box">
                        <input type="text" id="game-search" class="search-input" placeholder="Search games...">
                    </div>
                    <div class="game-selector">
                        <select id="game-select" class="select-input" size="8">
                            <option value="">Choose a game...</option>
                        </select>
                    </div>
                    <button id="manage-content-btn" class="btn btn-primary" style="margin-top: 10px; width: 100%;">
                        Manage Content...
                    </button>

                    <div id="game-info" class="game-info" style="display: none;">
                        <div class="info-row">
                            <span class="label">Provider:</span>
                            <span id="provider-name" class="value"></span>
                        </div>
                        <div class="info-row">
                            <span class="label">Game:</span>
                            <span id="game-name" class="value"></span>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2>Blur Band</h2>
                    <div class="control-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="blur-enabled" checked>
                            <span>Enable blur band</span>
                        </label>

                        <div id="blur-options" class="blur-options">
                            <div class="radio-group">
                                <label class="radio-label">
                                    <input type="radio" name="blur-mode" value="auto" checked>
                                    <span>Auto-detect from background</span>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="blur-mode" value="manual">
                                    <span>Manual color selection</span>
                                </label>
                            </div>

                            <div id="color-picker-group" class="color-picker-group" style="display: none;">
                                <label for="blur-color">Blur Color:</label>
                                <input type="color" id="blur-color" value="#000000">
                                <span id="color-preview" class="color-preview"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2>Title</h2>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="title-mode" value="text" checked>
                            <span>Auto from folder name</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="title-mode" value="image">
                            <span>Use title image</span>
                        </label>
                    </div>

                    <div class="control-group" id="title-select-group" style="display: none;">
                        <label for="title-select">Title Image:</label>
                        <select id="title-select" class="select-input">
                        </select>
                    </div>
                </div>

                <div class="section">
                    <h2>Provider</h2>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="provider-mode" value="none">
                            <span>Don't show</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="provider-mode" value="text" checked>
                            <span>Auto from provider name</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="provider-mode" value="logo">
                            <span>Use provider logo</span>
                        </label>
                    </div>

                    <div class="control-group" id="logo-select-group" style="display: none;">
                        <label for="logo-select">Provider Logo:</label>
                        <select id="logo-select" class="select-input">
                        </select>
                    </div>
                </div>

                <div id="preview-container" class="preview-container" style="display: none;">
                    <h3>Live Preview</h3>
                    <p class="help-text" style="margin-bottom: 12px;">Preview updates automatically as you adjust settings</p>
                    <img id="preview-image" src="" alt="Generated thumbnail">
                </div>

                <div class="section">
                    <h2>Advanced Settings</h2>

                    <!-- Asset Selectors -->
                    <div class="control-group" id="background-select-group" style="display: none;">
                        <label>Backgrounds:</label>
                        <div id="background-checkboxes" class="asset-checkboxes">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>

                    <div class="control-group" id="character-select-group" style="display: none;">
                        <label>Characters:</label>
                        <div id="character-checkboxes" class="asset-checkboxes">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Sliders -->
                    <div class="control-group">
                        <label for="text-scale" class="slider-label">Text Size</label>
                        <input type="range" id="text-scale" min="0.8" max="1.2" step="0.02" value="1" class="slider">
                        <div class="slider-value"><span id="text-scale-value">1.00x</span></div>
                    </div>
                    <div class="control-group">
                        <label for="text-offset" class="slider-label">Text Vertical Offset</label>
                        <input type="range" id="text-offset" min="-0.1" max="0.1" step="0.01" value="0" class="slider">
                        <div class="slider-value"><span id="text-offset-value">0.00</span></div>
                    </div>
                    <div class="control-group">
                        <label for="blur-scale" class="slider-label">Blur Band Intensity</label>
                        <input type="range" id="blur-scale" min="0.5" max="1.5" step="0.05" value="1" class="slider">
                        <div class="slider-value"><span id="blur-scale-value">1.00x</span></div>
                    </div>
                </div>

                <div class="section">
                    <h2>Title Font</h2>
                    <div class="control-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="custom-font-enabled">
                            <span>Use custom font</span>
                        </label>
                        <div id="font-select-container" class="font-select-container" style="display: none;">
                            <select id="font-select" class="select-input">
                                <option value="">Loading fonts...</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="actions">
                    <button id="generate-btn" class="btn btn-primary" disabled>
                        Generate Thumbnail
                    </button>
                    <button id="open-output-btn" class="btn btn-secondary">
                        Open Output Folder
                    </button>
                </div>

                <div id="single-status" class="status"></div>
            </div>
        </div>
    </div>

    <!-- Font Settings Modal -->
    <div id="provider-font-modal" class="modal-backdrop" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h2>Font Settings</h2>
                <button id="close-provider-font-modal" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Default Title Font Section -->
                <div class="modal-section">
                    <h3>Default Title Font</h3>
                    <p class="help-text">
                        Set the system-wide default font for all title text. Click "Set as Default" on any font below.
                    </p>
                    <div id="provider-modal-fonts-list" class="provider-fonts-list"></div>
                    <div id="provider-modal-font-status" class="help-text" style="margin-top: 8px; color: #10b981;"></div>
                </div>

                <!-- Provider Fonts Section -->
                <div class="modal-section">
                    <h3>Provider Fonts</h3>
                    <p class="help-text">
                        Set default fonts for provider text (the small text at the bottom of thumbnails)
                    </p>
                    <div class="provider-font-manager">
                        <div class="provider-font-row">
                            <select id="provider-font-provider" class="select-input">
                                <option value="">Select provider...</option>
                            </select>
                            <select id="provider-font-select" class="select-input">
                                <option value="">Select default font...</option>
                            </select>
                            <button id="save-provider-font-btn" class="btn btn-secondary">Save</button>
                        </div>
                        <div id="provider-fonts-list" class="provider-fonts-list"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Unified Content Management Modal -->
    <div id="manage-content-modal" class="modal-backdrop" style="display: none;">
        <div class="modal large-modal">
            <div class="modal-header">
                <h2>Manage Content</h2>
                <button id="close-manage-content-modal" class="modal-close">&times;</button>
            </div>

            <!-- Tab Navigation -->
            <div class="tab-nav">
                <button class="tab-button active" data-tab="games">Games</button>
                <button class="tab-button" data-tab="assets">Assets</button>
                <button class="tab-button" data-tab="fonts">Fonts</button>
            </div>

            <div class="modal-body">
                <!-- Games Tab -->
                <div id="tab-games" class="tab-content active">
                    <h3>Create New Game</h3>
                    <p class="help-text">Add a new game to your collection</p>

                    <div class="control-group">
                        <label for="new-provider-select">Provider:</label>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <select id="new-provider-select" class="select-input" style="flex: 1;">
                                <option value="">Loading providers...</option>
                            </select>
                            <button id="new-provider-toggle-btn" class="btn btn-secondary" style="flex-shrink: 0;">
                                New Provider
                            </button>
                        </div>
                    </div>

                    <div id="new-provider-input-group" class="control-group" style="display: none;">
                        <label for="new-provider-name">New Provider Name:</label>
                        <input type="text" id="new-provider-name" class="select-input" placeholder="e.g., Pragmatic Play">
                    </div>

                    <div class="control-group">
                        <label for="new-game-name">Game Name:</label>
                        <input type="text" id="new-game-name" class="select-input" placeholder="e.g., Big Bass Bonanza" required>
                    </div>

                    <div class="modal-actions">
                        <button id="create-game-submit-btn" class="btn btn-primary">Create Game</button>
                    </div>

                    <div id="create-game-status" class="help-text" style="margin-top: 12px;"></div>
                </div>

                <!-- Assets Tab -->
                <div id="tab-assets" class="tab-content" style="display: none;">
                    <h3>Add Assets</h3>
                    <p class="help-text">Upload images for backgrounds, characters, titles, and logos</p>

                    <div class="control-group" id="asset-game-selector">
                        <label>Target Game:</label>
                        <select id="asset-target-game" class="select-input">
                            <option value="">Select a game...</option>
                        </select>
                        <p class="help-text" style="margin-top: 4px;">Select the game to add assets to</p>
                    </div>

                    <div id="asset-upload-area" style="display: none;">
                        <input type="file" id="asset-files-input" accept="image/*" multiple style="display: none;">

                        <div id="drop-zone" class="drop-zone">
                            <div class="drop-zone-content">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="17 8 12 3 7 8"></polyline>
                                    <line x1="12" y1="3" x2="12" y2="15"></line>
                                </svg>
                                <p><strong>Drop images here</strong></p>
                                <p class="help-text">or</p>
                                <button id="select-files-btn" class="btn btn-secondary">Browse Files</button>
                            </div>
                        </div>
                        <div id="selected-files-info" class="help-text" style="margin-top: 12px;"></div>

                        <div id="upload-progress" style="display: none; margin: 20px 0;">
                            <p>Analyzing images...</p>
                            <div class="progress-bar">
                                <div id="upload-progress-fill" class="progress-fill"></div>
                            </div>
                        </div>

                        <div id="classification-results" style="display: none;">
                            <h3>Classification Results</h3>
                            <p class="help-text">Review and adjust classifications below. Items marked in red require manual classification.</p>

                            <table class="classification-table">
                                <thead>
                                    <tr>
                                        <th>Preview</th>
                                        <th>Filename</th>
                                        <th>Detected Type</th>
                                        <th>Confidence</th>
                                        <th>Manual Override</th>
                                    </tr>
                                </thead>
                                <tbody id="classification-table-body">
                                </tbody>
                            </table>

                            <div class="modal-actions" style="margin-top: 20px;">
                                <button id="save-classified-assets-btn" class="btn btn-primary">Save Assets</button>
                                <button id="cancel-upload-btn" class="btn btn-secondary">Cancel</button>
                            </div>

                            <div id="upload-status" class="help-text" style="margin-top: 12px;"></div>
                        </div>
                    </div>
                </div>

                <!-- Fonts Tab -->
                <div id="tab-fonts" class="tab-content" style="display: none;">
                    <h3>Manage Fonts</h3>
                    <p class="help-text">Upload fonts and configure defaults</p>

                    <!-- Font Upload Section -->
                    <div class="modal-section">
                        <h4>Upload Fonts</h4>
                        <p class="help-text">Upload .ttf or .otf font files to use in your thumbnails</p>

                        <input type="file" id="font-files-input" accept=".ttf,.otf" multiple style="display: none;">

                        <div id="font-drop-zone" class="drop-zone">
                            <div class="drop-zone-content">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="17 8 12 3 7 8"></polyline>
                                    <line x1="12" y1="3" x2="12" y2="15"></line>
                                </svg>
                                <p><strong>Drop font files here</strong></p>
                                <p class="help-text">or</p>
                                <button id="select-fonts-btn" class="btn btn-secondary">Browse Fonts</button>
                            </div>
                        </div>
                        <div id="selected-fonts-info" class="help-text" style="margin-top: 12px;"></div>

                        <div id="font-upload-status" class="help-text" style="margin-top: 12px;"></div>
                    </div>

                    <!-- All Fonts List Section -->
                    <div class="modal-section" style="margin-top: 24px;">
                        <h4>Available Fonts</h4>
                        <p class="help-text">
                            All fonts available in your system. Click "Set as Default" to use a font as the default title font.
                        </p>
                        <div id="all-fonts-list" class="provider-fonts-list"></div>
                        <div id="default-font-status" class="help-text" style="margin-top: 8px; color: #10b981;"></div>
                    </div>

                    <!-- Provider Fonts Section -->
                    <div class="modal-section" style="margin-top: 24px;">
                        <h4>Provider Fonts</h4>
                        <p class="help-text">
                            Set default fonts for provider text (the small text at the bottom of thumbnails)
                        </p>
                        <div class="provider-font-manager">
                            <div class="provider-font-row">
                                <select id="manage-provider-font-provider" class="select-input">
                                    <option value="">Select provider...</option>
                                </select>
                                <select id="manage-provider-font-select" class="select-input">
                                    <option value="">Select default font...</option>
                                </select>
                                <button id="manage-save-provider-font-btn" class="btn btn-secondary">Save</button>
                            </div>
                            <div id="manage-provider-fonts-list" class="provider-fonts-list"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
<!-- Cache bust -->
